/* ---------------------------------------------------------------------------------------
admin.controllers.js
All the controllers specific to admin only
------------------------------------------------------------------------------------------ */

import { ApiError, ApiResponse, asyncHandler } from "../utils/index.utils.js";
import { CourseCategory } from "../models/index.model.js";

/* ---------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
                                CATEGORY MANAGEMENT
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------ */

/* ---------------------------------------------------------------------------------------
CREATE CATEGORY CONTROLLER
------------------------------------------------------------------------------------------ */

const createCategoryFunction = async (req, res) => {
  // getting all the data
  const { name, description } = req.body;

  const isEmpty = [name, description].some((ele) => ele.trim() === "");

  if (isEmpty) {
    console.error("CREATE CATEGORY ERROR: empty fields!");
    throw new ApiError(400, "Both the fields are required!");
  }

  // checking if this category already exists
  const existingCategory = await CourseCategory.findOne({
    name: { $regex: name, $options: "i" },
  });

  if (existingCategory) {
    console.error("CREATE CATEGORY ERROR: category exists!");
    throw new ApiError(400, "Category already exists!");
  }

  const category = await CourseCategory.create({
    name: name,
    description: description,
  });

  if (!category) {
    console.error("CREATE CATEGORY ERROR: category creation failed!");
    throw new ApiError(
      500,
      "There was a problem while creating the category. Please try again!"
    );
  }

  return res
    .status(201)
    .json(new ApiResponse(201, "The category has been successfully created!"));
};

/* ---------------------------------------------------------------------------------------
UPDATE CATEGORY CONTROLLER
------------------------------------------------------------------------------------------ */

/* ---------------------------------------------------------------------------------------
SHOW ALL CATEGORIES CONTROLLER
------------------------------------------------------------------------------------------ */

/* ---------------------------------------------------------------------------------------
DELETE CATEGORY CONTROLLER
------------------------------------------------------------------------------------------ */

/* ---------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
                                USER AND COURSE MANAGEMENT
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------ */

/* ---------------------------------------------------------------------------------------
SHOW ALL USERS CONTROLLER
------------------------------------------------------------------------------------------ */

/* ---------------------------------------------------------------------------------------
DELETE A USER CONTROLLER
------------------------------------------------------------------------------------------ */

/* ---------------------------------------------------------------------------------------
DELETE A COURSE CONTROLLER
------------------------------------------------------------------------------------------ */

/* ---------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
                                SYSTEM STATS (the count of everything)
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------ */

const createCategory = asyncHandler(createCategoryFunction);

export { createCategory };
